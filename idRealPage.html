<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="logo.jpg" />
    <title>Test http request</title>
    <style>
﻿       .dsiplayRealFilm{
        border:solid 1px black
        }

        /*.celle{
        text-align:center;
        width:20vw;
        margin-top:0;
        margin-bottom:0;
        border:solid 1px black;
        } */      
    </style>

</head>
<body onload=" Init();">
    <a href="index.html">Retour à la page principale</a>
    <h1>Exemple de manipulation de donnée d'un XML</h1>
    <!-- Créer une liste de sélection des idReal. Quand selectionné, afficher en dessous l'ensemble des films du réalisateur, avec du css -->
    <div>
        <p>Choissisez un id de réalisateur pour afficher ces réalisations.</p>
        <br/>
        <select name="select_idReal" id="id_selection_idReal" onchange="OnSelectDisplay(this)">
            <option id="option1">Choisissez un id de réalisateur</option>
        </select>
        <div id="dsiplayRealFilm" class="dsiplayRealFilm">
            <p>Ici sera affiché la liste des films du réalisateur sélectionner.</p>
        </div>
    </div>



<script type="text/javascript">
    
    //Variable qui sera utile pour répertorier les nodes des films.
    var allFilm;
    //Variable qui sera utile pour compter le nombre de film.
    var nbFilm = 0;

    function Init()
    {
        var xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function() 
        {
            if (xhttp.readyState == 4 && xhttp.status == 200)//Quand la requête est terminée
            {
                var parser = new DOMParser();
                var XMLDoc = parser.parseFromString(xhttp.responseText, "text/html");
                var liste = document.getElementById('id_selection_idReal');

                allFilm = XMLDoc.getElementsByTagName('film');
                nbFilm = allFilm.length;
                

                //Boucle ajoutant les options dans le select
                for(i = 0; i < nbFilm; i++)
                {
                    var option = document.createElement('option');
                    option.setAttribute("value", allFilm[i].getAttribute('idreal'));
                    var text = document.createTextNode(allFilm[i].getAttribute('idreal'));
                    option.appendChild(text);
                    liste.appendChild(option);
                }
            }
        }
        xhttp.open("GET", "MesFilms.xml", true);
        xhttp.send();
    }

    function OnSelectDisplay(selectObject) 
    {
        //On récupère le container qui va accueillir les donnée à afficher selon le réal selctionner.
        var container = document.getElementById('dsiplayRealFilm');
        var realSelected = selectObject.value;
        container.innerHTML = "<p><strong><em>Voci la liste des films du réalisateur sélectionner :</em></strong></p>"
        //console.log(realSelected);
        //console.log(allFilm);
        for(i = 0; i < nbFilm; i++)
        {
            var strCompar = allFilm[i].getAttribute('idreal');
            if (realSelected == strCompar){
            container.innerHTML = container.innerHTML + (allFilm[i].getElementsByTagName('titre')[0].innerHTML) + "<br/>";
            }
        }
    }





</script>

</body>
<foot>
    <p><em>Benoît Lamarre</em></p>
</foot>

</html>